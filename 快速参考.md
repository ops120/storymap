# 众生谱快速参考 v1.0

**作者：你们喜爱的老王**

---

## 🚀 启动命令

```bash
# 一键启动（推荐）
start.cmd

# 分别启动
start_backend.cmd    # 后端
start_frontend.cmd   # 前端

# 手动启动
conda activate vevo
python backend/main.py
cd frontend && npm run dev
```

## 🔍 检查命令

```bash
# 环境检查
check_env.cmd

# API 测试
conda activate vevo
python test_api.py

# 查看 conda 环境
conda env list

# 查看依赖
conda activate vevo
pip list
```

## 📦 安装命令

```bash
# 创建 vevo 环境
conda env create -f environment.yml

# 或手动创建
conda create -n vevo python=3.10
conda activate vevo
pip install -r requirements.txt

# 安装前端依赖
cd frontend
npm install
```

## 🌐 访问地址

- **前端应用**: http://localhost:5173
- **后端 API**: http://127.0.0.1:8000
- **API 文档**: http://127.0.0.1:8000/docs

## 🔮 LLM 配置

### OpenAI
```
协议: openai
Base URL: https://api.openai.com/v1
Model ID: gpt-4, gpt-3.5-turbo
```

### 火山方舟
```
协议: volcano
Base URL: https://ark.cn-beijing.volces.com/api/v3
Model ID: ep-xxxxxx (Endpoint ID)
```

### 阿里百炼
```
协议: bailian
Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
Model ID: qwen-plus, qwen-turbo, qwen-max
```

## 📁 重要文件

```
storymap.db              # 数据库（包含所有数据）
environment.yml          # Conda 环境配置
requirements.txt         # Python 依赖
frontend/package.json    # 前端依赖
```

## 🛠️ 常用操作

### 备份数据
```bash
copy storymap.db storymap.db.backup
```

### 重置数据库
```bash
del storymap.db
# 重启后端，数据库会自动重建
```

### 导出项目
- 在应用中点击"📤 导出卷宗"
- 保存为 JSON 文件

### 导入项目
- 在应用中点击"📥 导入卷宗"
- 选择 JSON 文件

### 更新依赖
```bash
# Python 依赖
conda activate vevo
pip install -r requirements.txt --upgrade

# 前端依赖
cd frontend
npm update
```

## 🐛 故障排查

### 后端无法启动
```bash
# 1. 检查环境
conda activate vevo
python --version

# 2. 检查依赖
pip list

# 3. 查看错误
python backend/main.py
```

### 前端无法启动
```bash
# 1. 重新安装依赖
cd frontend
rm -rf node_modules
npm install

# 2. 清除缓存
npm cache clean --force
```

### 端口被占用
```bash
# 查找占用进程
netstat -ano | findstr :8000
netstat -ano | findstr :5173

# 结束进程
taskkill /PID <PID> /F
```

### 模型测试失败
1. 检查 API Key 是否正确
2. 检查 Base URL 是否可访问
3. 检查网络连接
4. 查看后端日志
5. 开启 Debug 模式查看详细信息

### 出现重复节点
1. 点击"🧹 清理重复"按钮
2. 系统自动合并同名节点
3. 优化系统提示词
4. 使用 Debug 模式检查 AI 输出

### 文本导入乱码
1. 系统会自动尝试多种编码
2. 支持 UTF-8、UTF-16、GBK
3. 如仍有问题，转换文件编码为 UTF-8
4. 或直接粘贴文本内容

## 📚 文档索引

- `README.md` - 项目说明
- `CHANGELOG-v1.0.md` - v1.0 版本详情 ⭐新增
- `安装指南.md` - 详细安装步骤
- `功能说明.md` - 功能详解
- `使用技巧.md` - 高效使用技巧
- `快速参考.md` - 本文件
- `项目结构.md` - 代码结构
- `LLM配置示例.md` - 配置示例
- `升级说明.md` - 版本升级指南
- `故障排查指南.md` - 问题解决
- `文档索引.md` - 文档导航

## 🎯 使用流程

1. **启动服务**: `start.cmd`
2. **访问应用**: http://localhost:5173
3. **创建卷宗**: 输入小说名称，点击 "+"
4. **配置模型**: 点击"🔮 法阵管理"，添加 LLM 模型
5. **测试连接**: 点击"🧪 测试连接"
6. **选择模型**: 点击"选择"按钮或在下拉框中选择
7. **输入文本**: 粘贴文本或点击"导入文本"上传 .txt 文件
8. **调整切片**: 可选调整切片大小（默认 500 字）
9. **开始分析**: 点击"🔥 开始炼化"
10. **查看图谱**: 右侧自动显示关系网络
11. **清理重复**: 如有重复节点，点击"🧹 清理重复"
12. **导出备份**: 点击"📤 导出卷宗"保存数据

## 💡 快捷键

- `F12` - 打开浏览器开发者工具
- `Ctrl+C` - 停止服务（在终端中）
- `Ctrl+Shift+R` - 强制刷新页面
- `回车` - 快速创建卷宗（在输入框中）

## 🎨 界面操作

### 布局调整
- 拖拽左右分隔条调整三栏宽度
- 最小宽度：左侧 200px，中间 300px
- 布局设置自动保存

### 图谱操作
- 拖拽画布：移动视图
- 滚轮缩放：调整大小
- 拖拽节点：调整位置
- 红色粗线：复合关系（如"同学 → 恋人 → 夫妻"）

### 卷宗管理
- 点击卷宗名：切换项目
- ✏️ 按钮：重命名卷宗
- 🗑️ 按钮：删除卷宗（需确认）
- 🧹 按钮：清理重复节点

### 配置管理
- ⚙️ 按钮：打开配置面板
- Debug 复选框：开启/关闭调试模式
- 切片大小：调整文本分块大小（100-5000）

## 📞 获取帮助

1. 查看文档（上方"文档索引"）
2. 运行环境检查：`check_env.cmd`
3. 运行 API 测试：`python test_api.py`
4. 查看后端日志（终端输出）
5. 查看前端日志（浏览器 F12 控制台）
6. 开启 Debug 模式查看详细信息

---

**众生谱 v1.0 - 让人物关系一目了然** 🎉  
**作者：你们喜爱的老王**
