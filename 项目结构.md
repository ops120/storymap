# 众生谱项目结构 v1.0

**作者：你们喜爱的老王**

---

```
story-map/
├── backend/                          # 后端服务
│   └── main.py                       # FastAPI 主程序
│
├── frontend/                         # 前端应用
│   ├── public/                       # 静态资源
│   │   └── vite.svg                  # Vite 图标
│   ├── src/                          # 源代码
│   │   ├── assets/                   # 资源文件
│   │   │   └── react.svg             # React 图标
│   │   ├── App.css                   # 应用样式
│   │   ├── App.jsx                   # 主应用组件
│   │   ├── config.js                 # 配置管理 ⭐v1.0 新增
│   │   ├── GraphView.jsx             # 关系图谱组件
│   │   ├── LLMManager.jsx            # LLM 模型管理组件
│   │   ├── ResizableLayout.jsx       # 可调整布局组件 ⭐v1.0 新增
│   │   ├── index.css                 # 全局样式
│   │   ├── main.jsx                  # 入口文件
│   │   └── store.js                  # Zustand 状态管理
│   ├── .gitignore                    # Git 忽略配置
│   ├── eslint.config.js              # ESLint 配置
│   ├── index.html                    # HTML 模板
│   ├── install.cmd                   # 前端安装脚本
│   ├── package.json                  # 前端依赖
│   ├── package-lock.json             # 依赖锁定
│   ├── README.md                     # 前端说明
│   └── vite.config.js                # Vite 配置
│
├── .git/                             # Git 版本控制
├── .vscode/                          # VS Code 配置
├── node_modules/                     # Node.js 依赖
│
├── 1.json                            # 示例数据
├── CHANGELOG-v1.0.md                 # v1.0 更新日志 ⭐新增
├── CHANGELOG.md                      # 历史更新日志
├── check_env.cmd                     # 环境检查脚本 ⭐新增
├── environment.yml                   # Conda 环境配置 ⭐新增
├── LLM配置示例.md                    # LLM 配置指南
├── package.json                      # 根目录依赖
├── package-lock.json                 # 根目录依赖锁定
├── README.md                         # 项目说明
├── requirements.txt                  # Python 依赖
├── start.cmd                         # 一键启动脚本
├── start_backend.cmd                 # 后端启动脚本 ⭐新增
├── start_frontend.cmd                # 前端启动脚本 ⭐新增
├── storymap.db                       # SQLite 数据库（运行时生成）
├── test_api.py                       # API 测试脚本
├── v2.1-修复说明.md                  # v2.1 版本说明
├── v2.2-布局优化说明.md              # v2.2 版本说明
├── v2.3-可调整布局说明.md            # v2.3 版本说明
├── 众生谱项目需求与架构文档.md      # 架构文档
├── 使用技巧.md                       # 使用技巧 ⭐更新
├── 功能说明.md                       # 功能说明 ⭐更新
├── 升级说明.md                       # 升级说明
├── 安装指南.md                       # 安装指南 ⭐更新
├── 开始使用.md                       # 快速开始
├── 快速参考.md                       # 快速参考 ⭐更新
├── 故障排查指南.md                   # 故障排查
├── 文档索引.md                       # 文档索引
├── 更新日志-v2.3.md                  # v2.3 更新日志
└── 项目结构.md                       # 本文件 ⭐更新
```

## 📁 目录说明

### backend/
后端服务目录，使用 FastAPI 框架。

**核心文件：**
- `main.py` - 主程序，包含所有 API 接口和数据库操作

**主要功能：**
- 项目管理（CRUD）
- LLM 模型管理（CRUD + 测试）
- 文本分析（调用 LLM API）
- 数据导入导出

### frontend/
前端应用目录，使用 React + Vite。

**核心组件：**
- `App.jsx` - 主应用，包含项目管理和文本输入
- `GraphView.jsx` - 关系图谱可视化（G6）
- `LLMManager.jsx` - LLM 模型管理界面
- `ResizableLayout.jsx` - 可调整布局组件（v1.0 新增）
- `config.js` - 配置管理（v1.0 新增）
- `store.js` - 全局状态管理（Zustand）

**主要功能：**
- 项目切换和管理（创建、重命名、删除）
- LLM 模型配置和测试
- 文本输入和分析（粘贴或导入文件）
- 关系图谱展示（力导向布局）
- 智能去重和关系合并
- 可调整的三栏布局
- Debug 模式和配置管理

### 数据库
`storymap.db` - SQLite 数据库文件（首次运行自动创建）

**数据表：**
- `projects` - 项目/卷宗表
- `nodes` - 人物节点表
- `edges` - 关系边表（v1.0 新增 stage 和 created_at 字段）
- `llm_models` - LLM 模型配置表

### 文档
- `README.md` - 项目说明和快速开始
- `CHANGELOG-v1.0.md` - v1.0 版本更新日志（新增）
- `CHANGELOG.md` - 历史版本更新日志
- `众生谱项目需求与架构文档.md` - 详细的技术架构文档
- `功能说明.md` - 功能详解和使用技巧（更新）
- `安装指南.md` - 详细安装步骤（更新）
- `使用技巧.md` - 高效使用技巧（更新）
- `快速参考.md` - 常用命令速查（更新）
- `项目结构.md` - 本文件（更新）
- `LLM配置示例.md` - 各种 LLM 的配置示例
- `升级说明.md` - 版本升级指南
- `故障排查指南.md` - 常见问题解决
- `文档索引.md` - 文档导航
- `v2.1-修复说明.md` - v2.1 版本说明
- `v2.2-布局优化说明.md` - v2.2 版本说明
- `v2.3-可调整布局说明.md` - v2.3 版本说明

### 脚本
- `start.cmd` - Windows 一键启动脚本（前后端）
- `start_backend.cmd` - 后端启动脚本（新增）
- `start_frontend.cmd` - 前端启动脚本（新增）
- `check_env.cmd` - 环境检查脚本（新增）
- `test_api.py` - API 接口测试脚本
- `requirements.txt` - Python 依赖列表
- `environment.yml` - Conda 环境配置（新增）

## 🔄 数据流转

```
用户操作
   ↓
前端组件 (React)
   ↓
状态管理 (Zustand)
   ↓
HTTP 请求 (Fetch API)
   ↓
后端接口 (FastAPI)
   ↓
数据库操作 (SQLite)
   ↓
LLM 调用 (OpenAI SDK)
   ↓
数据返回
   ↓
图谱渲染 (G6)
```

## 📦 依赖关系

### 后端依赖
```
fastapi==0.109.0      # Web 框架
uvicorn==0.27.0       # ASGI 服务器
openai==1.12.0        # OpenAI SDK
pydantic==2.6.0       # 数据验证
```

### 前端依赖
```
react@18.2.0          # UI 框架
@antv/g6@4.8.2        # 图形引擎
zustand@4.5.0         # 状态管理
vite@5.2.0            # 构建工具
```

## 🚀 启动流程

### 方式一：使用启动脚本（推荐）
```bash
start.cmd
```

### 方式二：手动启动
```bash
# 终端1：启动后端
python backend/main.py

# 终端2：启动前端
cd frontend
npm run dev
```

## 🧪 测试流程

### 1. 测试后端 API
```bash
python test_api.py
```

### 2. 测试前端
访问 `http://localhost:5173`，进行以下操作：
1. 创建新卷宗
2. 配置 LLM 模型
3. 测试模型连接
4. 输入文本进行分析
5. 查看关系图谱

## 📊 代码统计

```
文件类型          文件数    代码行数
─────────────────────────────────
Python              2        ~500
JavaScript          7        ~1500
Markdown           20        ~5000
JSON                3        ~100
CMD                 4        ~50
─────────────────────────────────
总计               36        ~7150
```

## 🆕 v1.0 新增内容

### 新增文件
- `frontend/src/config.js` - 配置管理系统
- `frontend/src/ResizableLayout.jsx` - 可调整布局组件
- `CHANGELOG-v1.0.md` - v1.0 版本更新日志
- `check_env.cmd` - 环境检查脚本
- `start_backend.cmd` - 后端启动脚本
- `start_frontend.cmd` - 前端启动脚本
- `environment.yml` - Conda 环境配置

### 更新文件
- `backend/main.py` - 新增清理重复、关系合并功能
- `frontend/src/App.jsx` - 新增文本导入、切片调整、清理按钮
- `frontend/src/store.js` - 新增去重、重命名、删除方法
- `frontend/src/GraphView.jsx` - 新增复合关系视觉增强
- 所有文档文件 - 更新为 v1.0 内容

### 数据库变更
- `edges` 表新增 `stage` 字段（关系阶段）
- `edges` 表新增 `created_at` 字段（创建时间）

## 🔧 开发建议

### 添加新功能
1. 后端：在 `backend/main.py` 添加新的路由
2. 前端：在 `frontend/src/` 创建新组件
3. 状态：在 `store.js` 添加新的状态和方法
4. 文档：更新相关 Markdown 文档

### 调试技巧
1. 后端：查看终端输出的日志
2. 前端：打开浏览器控制台（F12）
3. 数据库：使用 SQLite 工具查看 `storymap.db`
4. API：使用 Postman 或 `test_api.py` 测试

### 性能优化
1. 数据库：添加索引，优化查询
2. 前端：使用 React.memo 减少重渲染
3. API：实现缓存机制
4. 图谱：优化 G6 渲染性能

## 📝 注意事项

1. **数据库文件**：`storymap.db` 包含所有数据，请定期备份
2. **API Key**：敏感信息，不要提交到版本控制
3. **端口占用**：确保 8000 和 5173 端口未被占用
4. **依赖版本**：使用指定版本，避免兼容性问题

## 🔗 相关链接

- FastAPI 文档：https://fastapi.tiangolo.com/
- React 文档：https://react.dev/
- G6 文档：https://g6.antv.antgroup.com/
- Zustand 文档：https://zustand-demo.pmnd.rs/
